var channels={EXISTING_MESSAGES:"existing_messages",NEW_MESSAGE:"new_message"},connect=require("connect"),serveStatic=require("serve-static"),MongoClient=require("mongodb").MongoClient,sockets=require("socket.io").listen(8100).sockets;const DB_URL=process.env.DB_URL||"127.0.0.1",DB_PASSWORD=process.env.DB_PASSWORD||"password",DB_USERNAME=process.env.DB_TABLE||"chatClient",CONNECTION_URL="mongodb://"+DB_USERNAME+":"+DB_PASSWORD+"@"+DB_URL;connect().use(serveStatic(__dirname+"/../../client/build")).listen(80,function(a){if(a)return cb(a);var b=parseInt(process.env.SUDO_UID);b&&process.setuid(b),console.log("Started node.js server on http://localhost:80")}),MongoClient.connect(CONNECTION_URL,function(a,b){if(a)throw a;var c=b.db("chat");sockets.on("connection",function(a){var b=c.collection("messages");b.find().limit(100).sort({_id:1}).toArray(function(b,c){if(b)throw b;a.emit(channels.EXISTING_MESSAGES,c)})})});